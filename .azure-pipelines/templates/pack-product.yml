# Reusable template for packing a single Umbraco.Ai product
# Uses pre-built outputs from the Build stage
#
# Parameters:
#   product: Product name (e.g., "Umbraco.Ai", "Umbraco.Ai.OpenAi")
#
# Prerequisites:
#   - Build outputs must be downloaded to $(Build.SourcesDirectory)
#   - For tier 2/3 products, core packages must be in ./artifacts/nupkg
#
# Converted from GitHub Actions composite action: .github/actions/pack-product/action.yml

parameters:
  - name: product
    type: string

steps:
  - script: dotnet tool install --global nbgv || true
    displayName: Install NBGV

  - script: nbgv cloud
    displayName: Set version
    workingDirectory: ${{ parameters.product }}

  - script: dotnet restore ${{ parameters.product }}/${{ parameters.product }}.sln
    displayName: Restore packages

  - script: |
      dotnet pack ${{ parameters.product }}/${{ parameters.product }}.sln \
        --configuration Release \
        --no-build \
        --output ./artifacts/nupkg \
        -p:UseProjectReferences=false
    displayName: Pack ${{ parameters.product }}
