{"version":3,"file":"connection-detail.repository-gai7dQ-B.js","sources":["../Client/src/connection/repository/detail/connection-detail.server.data-source.ts","../Client/src/connection/repository/detail/connection-detail.repository.ts"],"sourcesContent":["import type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport type { UmbDetailDataSource } from \"@umbraco-cms/backoffice/repository\";\r\nimport { tryExecuteAndNotify } from \"@umbraco-cms/backoffice/resources\";\r\nimport { ConnectionsService } from \"../../../api/sdk.gen.js\";\r\nimport { UaiConnectionTypeMapper } from \"../../type-mapper.js\";\r\nimport type { UaiConnectionDetailModel } from \"../../types.js\";\r\nimport { UAI_CONNECTION_ENTITY_TYPE } from \"../../constants.js\";\r\n\r\n/**\r\n * Server data source for Connection detail operations.\r\n */\r\nexport class UaiConnectionDetailServerDataSource implements UmbDetailDataSource<UaiConnectionDetailModel> {\r\n    #host: UmbControllerHost;\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        this.#host = host;\r\n    }\r\n\r\n    /**\r\n     * Creates a scaffold for a new connection.\r\n     */\r\n    async createScaffold(preset?: Partial<UaiConnectionDetailModel>) {\r\n        const scaffold: UaiConnectionDetailModel = {\r\n            unique: \"\",\r\n            entityType: UAI_CONNECTION_ENTITY_TYPE,\r\n            alias: \"\",\r\n            name: \"\",\r\n            providerId: preset?.providerId ?? \"\",\r\n            settings: null,\r\n            isActive: true,\r\n            ...preset,\r\n        };\r\n\r\n        return { data: scaffold };\r\n    }\r\n\r\n    /**\r\n     * Reads a connection by its unique identifier.\r\n     */\r\n    async read(unique: string) {\r\n        const { data, error } = await tryExecuteAndNotify(\r\n            this.#host,\r\n            ConnectionsService.getConnectionById({ path: { id: unique } })\r\n        );\r\n\r\n        if (error || !data) {\r\n            return { error };\r\n        }\r\n\r\n        return { data: UaiConnectionTypeMapper.toDetailModel(data) };\r\n    }\r\n\r\n    /**\r\n     * Creates a new connection.\r\n     */\r\n    async create(model: UaiConnectionDetailModel, _parentUnique: string | null) {\r\n        const requestBody = UaiConnectionTypeMapper.toCreateRequest(model);\r\n\r\n        const { response, error } = await tryExecuteAndNotify(\r\n            this.#host,\r\n            ConnectionsService.postConnection({ body: requestBody })\r\n        );\r\n\r\n        if (error) {\r\n            return { error };\r\n        }\r\n\r\n        // Extract the ID from the Location header\r\n        const locationHeader = response?.headers?.get(\"Location\") ?? \"\";\r\n        const unique = locationHeader.split(\"/\").pop() ?? \"\";\r\n\r\n        return {\r\n            data: {\r\n                ...model,\r\n                unique,\r\n            },\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Updates an existing connection.\r\n     */\r\n    async update(model: UaiConnectionDetailModel) {\r\n        const requestBody = UaiConnectionTypeMapper.toUpdateRequest(model);\r\n\r\n        const { error } = await tryExecuteAndNotify(\r\n            this.#host,\r\n            ConnectionsService.putConnectionById({\r\n                path: { id: model.unique },\r\n                body: requestBody,\r\n            })\r\n        );\r\n\r\n        if (error) {\r\n            return { error };\r\n        }\r\n\r\n        return { data: model };\r\n    }\r\n\r\n    /**\r\n     * Deletes a connection by its unique identifier.\r\n     */\r\n    async delete(unique: string) {\r\n        const { error } = await tryExecuteAndNotify(\r\n            this.#host,\r\n            ConnectionsService.deleteConnectionById({ path: { id: unique } })\r\n        );\r\n\r\n        if (error) {\r\n            return { error };\r\n        }\r\n\r\n        return {};\r\n    }\r\n}\r\n","import { UmbDetailRepositoryBase } from \"@umbraco-cms/backoffice/repository\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UaiConnectionDetailServerDataSource } from \"./connection-detail.server.data-source.js\";\r\nimport { UAI_CONNECTION_DETAIL_STORE_CONTEXT } from \"./connection-detail.store.js\";\r\nimport type { UaiConnectionDetailModel } from \"../../types.js\";\r\n\r\n/**\r\n * Repository for Connection detail CRUD operations.\r\n * Uses UmbDetailRepositoryBase for consistent CMS patterns.\r\n */\r\nexport class UaiConnectionDetailRepository extends UmbDetailRepositoryBase<UaiConnectionDetailModel> {\r\n    constructor(host: UmbControllerHost) {\r\n        super(host, UaiConnectionDetailServerDataSource, UAI_CONNECTION_DETAIL_STORE_CONTEXT);\r\n    }\r\n\r\n    override async create(model: UaiConnectionDetailModel) {\r\n        return super.create(model, null);\r\n    }\r\n}\r\n\r\nexport { UaiConnectionDetailRepository as api };\r\n"],"names":["UaiConnectionDetailServerDataSource","#host","host","preset","UAI_CONNECTION_ENTITY_TYPE","unique","data","error","tryExecuteAndNotify","ConnectionsService","UaiConnectionTypeMapper","model","_parentUnique","requestBody","response","UaiConnectionDetailRepository","UmbDetailRepositoryBase","UAI_CONNECTION_DETAIL_STORE_CONTEXT"],"mappings":";;;;;AAWO,MAAMA,EAA6F;AAAA,EACtGC;AAAA,EAEA,YAAYC,GAAyB;AACjC,SAAKD,KAAQC;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAeC,GAA4C;AAY7D,WAAO,EAAE,MAXkC;AAAA,MACvC,QAAQ;AAAA,MACR,YAAYC;AAAA,MACZ,OAAO;AAAA,MACP,MAAM;AAAA,MACN,YAAYD,GAAQ,cAAc;AAAA,MAClC,UAAU;AAAA,MACV,UAAU;AAAA,MACV,GAAGA;AAAA,IAAA,EAGQ;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAKE,GAAgB;AACvB,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAA,IAAU,MAAMC;AAAA,MAC1B,KAAKP;AAAA,MACLQ,EAAmB,kBAAkB,EAAE,MAAM,EAAE,IAAIJ,EAAA,GAAU;AAAA,IAAA;AAGjE,WAAIE,KAAS,CAACD,IACH,EAAE,OAAAC,EAAA,IAGN,EAAE,MAAMG,EAAwB,cAAcJ,CAAI,EAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAOK,GAAiCC,GAA8B;AACxE,UAAMC,IAAcH,EAAwB,gBAAgBC,CAAK,GAE3D,EAAE,UAAAG,GAAU,OAAAP,EAAA,IAAU,MAAMC;AAAA,MAC9B,KAAKP;AAAA,MACLQ,EAAmB,eAAe,EAAE,MAAMI,GAAa;AAAA,IAAA;AAG3D,QAAIN;AACA,aAAO,EAAE,OAAAA,EAAA;AAKb,UAAMF,KADiBS,GAAU,SAAS,IAAI,UAAU,KAAK,IAC/B,MAAM,GAAG,EAAE,SAAS;AAElD,WAAO;AAAA,MACH,MAAM;AAAA,QACF,GAAGH;AAAA,QACH,QAAAN;AAAA,MAAA;AAAA,IACJ;AAAA,EAER;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAOM,GAAiC;AAC1C,UAAME,IAAcH,EAAwB,gBAAgBC,CAAK,GAE3D,EAAE,OAAAJ,EAAA,IAAU,MAAMC;AAAA,MACpB,KAAKP;AAAA,MACLQ,EAAmB,kBAAkB;AAAA,QACjC,MAAM,EAAE,IAAIE,EAAM,OAAA;AAAA,QAClB,MAAME;AAAA,MAAA,CACT;AAAA,IAAA;AAGL,WAAIN,IACO,EAAE,OAAAA,EAAA,IAGN,EAAE,MAAMI,EAAA;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAON,GAAgB;AACzB,UAAM,EAAE,OAAAE,EAAA,IAAU,MAAMC;AAAA,MACpB,KAAKP;AAAA,MACLQ,EAAmB,qBAAqB,EAAE,MAAM,EAAE,IAAIJ,EAAA,GAAU;AAAA,IAAA;AAGpE,WAAIE,IACO,EAAE,OAAAA,EAAA,IAGN,CAAA;AAAA,EACX;AACJ;ACzGO,MAAMQ,UAAsCC,EAAkD;AAAA,EACjG,YAAYd,GAAyB;AACjC,UAAMA,GAAMF,GAAqCiB,CAAmC;AAAA,EACxF;AAAA,EAEA,MAAe,OAAON,GAAiC;AACnD,WAAO,MAAM,OAAOA,GAAO,IAAI;AAAA,EACnC;AACJ;"}