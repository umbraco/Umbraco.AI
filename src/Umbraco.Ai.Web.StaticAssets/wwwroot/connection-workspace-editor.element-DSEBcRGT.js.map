{"version":3,"file":"connection-workspace-editor.element-DSEBcRGT.js","sources":["../Client/src/connection/workspace/connection-workspace-editor.element.ts"],"sourcesContent":["import { css, html, customElement, state, when } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport type { UUIInputElement, UUIInputEvent } from \"@umbraco-cms/backoffice/external/uui\";\r\nimport { UmbTextStyles } from \"@umbraco-cms/backoffice/style\";\r\nimport { UaiConnectionWorkspaceContext } from \"./connection-workspace.context.js\";\r\nimport { UaiConnectionConstants } from \"../constants.js\";\r\nimport type { UaiConnectionDetailModel } from \"../types.js\";\r\nimport { UaiPartialUpdateCommand } from \"../../core/command/implement/partial-update.command.js\";\r\n\r\nimport \"../views/connection-details.element.js\";\r\n\r\n@customElement(\"uai-connection-workspace-editor\")\r\nexport class UaiConnectionWorkspaceEditorElement extends UmbLitElement {\r\n    #workspaceContext = new UaiConnectionWorkspaceContext(this);\r\n\r\n    @state()\r\n    private _model?: UaiConnectionDetailModel;\r\n\r\n    @state()\r\n    private _isNew?: boolean;\r\n\r\n    @state()\r\n    private _aliasLocked = true;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.observe(this.#workspaceContext.model, (model) => {\r\n            this._model = model;\r\n        });\r\n\r\n        this.observe(this.#workspaceContext.isNew, (isNew) => {\r\n            this._isNew = isNew;\r\n            if (isNew) {\r\n                requestAnimationFrame(() => {\r\n                    (this.shadowRoot?.querySelector(\"#name\") as HTMLElement)?.focus();\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    #onNameChange(event: UUIInputEvent) {\r\n        event.stopPropagation();\r\n        const target = event.composedPath()[0] as UUIInputElement;\r\n        const name = target.value.toString();\r\n\r\n        // If alias is locked and creating new, generate alias from name\r\n        if (this._aliasLocked && this._isNew) {\r\n            const alias = this.#generateAlias(name);\r\n            this.#workspaceContext.handleCommand(\r\n                new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ name, alias }, \"name-alias\")\r\n            );\r\n        } else {\r\n            this.#workspaceContext.handleCommand(\r\n                new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ name }, \"name\")\r\n            );\r\n        }\r\n    }\r\n\r\n    #onAliasChange(event: UUIInputEvent) {\r\n        event.stopPropagation();\r\n        const target = event.composedPath()[0] as UUIInputElement;\r\n        this.#workspaceContext.handleCommand(\r\n            new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ alias: target.value.toString() }, \"alias\")\r\n        );\r\n    }\r\n\r\n    #onToggleAliasLock() {\r\n        this._aliasLocked = !this._aliasLocked;\r\n    }\r\n\r\n    #generateAlias(name: string): string {\r\n        return name\r\n            .toLowerCase()\r\n            .replace(/[^a-z0-9]+/g, \"-\")\r\n            .replace(/^-|-$/g, \"\");\r\n    }\r\n\r\n    render() {\r\n        if (!this._model) return html`<uui-loader></uui-loader>`;\r\n\r\n        return html`\r\n            <umb-workspace-editor alias=\"${UaiConnectionConstants.Workspace.Entity}\">\r\n                <div id=\"header\" slot=\"header\">\r\n                    <uui-button\r\n                        href=\"section/settings/workspace/${UaiConnectionConstants.Workspace.Root}\"\r\n                        label=\"Back to connections\"\r\n                        compact\r\n                    >\r\n                        <uui-icon name=\"icon-arrow-left\"></uui-icon>\r\n                    </uui-button>\r\n                    <uui-input\r\n                        id=\"name\"\r\n                        .value=${this._model.name}\r\n                        @input=\"${this.#onNameChange}\"\r\n                        label=\"Name\"\r\n                        placeholder=\"Enter connection name\"\r\n                    >\r\n                        <uui-input-lock\r\n                            slot=\"append\"\r\n                            id=\"alias\"\r\n                            name=\"alias\"\r\n                            label=\"Alias\"\r\n                            placeholder=\"Enter alias\"\r\n                            .value=${this._model.alias}\r\n                            ?auto-width=${!!this._model.name}\r\n                            ?locked=${this._aliasLocked}\r\n                            ?readonly=${this._aliasLocked || !this._isNew}\r\n                            @input=${this.#onAliasChange}\r\n                            @lock-change=${this.#onToggleAliasLock}\r\n                        ></uui-input-lock>\r\n                    </uui-input>\r\n                </div>\r\n\r\n                ${when(\r\n                    !this._isNew && this._model,\r\n                    () => html`<umb-workspace-entity-action-menu slot=\"action-menu\"></umb-workspace-entity-action-menu>`\r\n                )}\r\n\r\n                <uai-connection-details></uai-connection-details>\r\n\r\n                <div slot=\"footer-info\" id=\"footer\">\r\n                    <a href=\"section/settings/workspace/${UaiConnectionConstants.Workspace.Root}\">Connections</a>\r\n                    / ${this._model.name || \"Untitled\"}\r\n                </div>\r\n            </umb-workspace-editor>\r\n        `;\r\n    }\r\n\r\n    static styles = [\r\n        UmbTextStyles,\r\n        css`\r\n            :host {\r\n                display: block;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n\r\n            #header {\r\n                display: flex;\r\n                flex: 1 1 auto;\r\n                gap: var(--uui-size-space-2);\r\n            }\r\n\r\n            #name {\r\n                width: 100%;\r\n                flex: 1 1 auto;\r\n                align-items: center;\r\n            }\r\n\r\n            #footer {\r\n                padding: 0 var(--uui-size-layout-1);\r\n            }\r\n        `,\r\n    ];\r\n}\r\n\r\nexport default UaiConnectionWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        \"uai-connection-workspace-editor\": UaiConnectionWorkspaceEditorElement;\r\n    }\r\n}\r\n"],"names":["_workspaceContext","_UaiConnectionWorkspaceEditorElement_instances","onNameChange_fn","onAliasChange_fn","onToggleAliasLock_fn","generateAlias_fn","UaiConnectionWorkspaceEditorElement","UmbLitElement","__privateAdd","UaiConnectionWorkspaceContext","__privateGet","model","isNew","html","UaiConnectionConstants","__privateMethod","when","event","name","alias","UaiPartialUpdateCommand","target","UmbTextStyles","css","__decorateClass","state","customElement","UaiConnectionWorkspaceEditorElement_default"],"mappings":"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"}