{"version":3,"file":"connection-workspace.context-CTquc_4b.js","sources":["../Client/src/core/command/command.store.ts","../Client/src/connection/workspace/connection-root/paths.ts","../Client/src/connection/workspace/connection/connection-workspace-editor.element.ts","../Client/src/connection/workspace/connection/connection-workspace.context.ts"],"sourcesContent":["import type { UaiCommand } from \"./command.base.js\";\r\n\r\nexport class UaiCommandStore {\r\n    #muted = false;\r\n    #commands: UaiCommand[] = [];\r\n\r\n    add(command: UaiCommand) {\r\n        if (this.#muted) return;\r\n        // Replace command with same correlationId or append\r\n        this.#commands = [\r\n            ...this.#commands.filter(x => !command.correlationId || x.correlationId !== command.correlationId),\r\n            command,\r\n        ];\r\n    }\r\n\r\n    getAll(): UaiCommand[] {\r\n        return this.#muted ? [] : [...this.#commands];\r\n    }\r\n\r\n    mute() { this.#muted = true; }\r\n    unmute() { this.#muted = false; }\r\n    clear() { this.#commands = []; }\r\n    reset() { this.clear(); this.unmute(); }\r\n}\r\n","import { UMB_WORKSPACE_PATH_PATTERN } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UAI_CONNECTION_ROOT_ENTITY_TYPE } from \"../../constants.js\";\r\nimport { UMB_SETTINGS_SECTION_PATHNAME } from \"@umbraco-cms/backoffice/settings\";\r\n\r\nexport const UAI_CONNECTION_ROOT_WORKSPACE_PATH = UMB_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n    sectionName: UMB_SETTINGS_SECTION_PATHNAME,\r\n    entityType: UAI_CONNECTION_ROOT_ENTITY_TYPE,\r\n});\r\n","import { css, html, customElement, state, when } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport type { UUIInputElement, UUIInputEvent } from \"@umbraco-cms/backoffice/external/uui\";\r\nimport { UmbTextStyles } from \"@umbraco-cms/backoffice/style\";\r\nimport { UAI_CONNECTION_WORKSPACE_CONTEXT } from \"./connection-workspace.context-token.js\";\r\nimport { UAI_CONNECTION_WORKSPACE_ALIAS } from \"../../constants.js\";\r\nimport type { UaiConnectionDetailModel } from \"../../types.js\";\r\nimport { UaiPartialUpdateCommand } from \"../../../core/command/implement/partial-update.command.js\";\r\nimport { UAI_CONNECTION_ROOT_WORKSPACE_PATH } from \"../connection-root/paths.js\";\r\n\r\n@customElement(\"uai-connection-workspace-editor\")\r\nexport class UaiConnectionWorkspaceEditorElement extends UmbLitElement {\r\n    #workspaceContext?: typeof UAI_CONNECTION_WORKSPACE_CONTEXT.TYPE;\r\n\r\n    @state()\r\n    private _model?: UaiConnectionDetailModel;\r\n\r\n    @state()\r\n    private _isNew?: boolean;\r\n\r\n    @state()\r\n    private _aliasLocked = true;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UAI_CONNECTION_WORKSPACE_CONTEXT, (context) => {\r\n            if (!context) return;\r\n            this.#workspaceContext = context;\r\n            this.observe(context.model, (model) => {\r\n                this._model = model;\r\n            });\r\n            this.observe(context.isNew, (isNew) => {\r\n                this._isNew = isNew;\r\n                if (isNew) {\r\n                    requestAnimationFrame(() => {\r\n                        (this.shadowRoot?.querySelector(\"#name\") as HTMLElement)?.focus();\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    #onNameChange(event: UUIInputEvent) {\r\n        event.stopPropagation();\r\n        const target = event.composedPath()[0] as UUIInputElement;\r\n        const name = target.value.toString();\r\n\r\n        // If alias is locked and creating new, generate alias from name\r\n        if (this._aliasLocked && this._isNew) {\r\n            const alias = this.#generateAlias(name);\r\n            this.#workspaceContext?.handleCommand(\r\n                new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ name, alias }, \"name-alias\")\r\n            );\r\n        } else {\r\n            this.#workspaceContext?.handleCommand(\r\n                new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ name }, \"name\")\r\n            );\r\n        }\r\n    }\r\n\r\n    #onAliasChange(event: UUIInputEvent) {\r\n        event.stopPropagation();\r\n        const target = event.composedPath()[0] as UUIInputElement;\r\n        this.#workspaceContext?.handleCommand(\r\n            new UaiPartialUpdateCommand<UaiConnectionDetailModel>({ alias: target.value.toString() }, \"alias\")\r\n        );\r\n    }\r\n\r\n    #onToggleAliasLock() {\r\n        this._aliasLocked = !this._aliasLocked;\r\n    }\r\n\r\n    #generateAlias(name: string): string {\r\n        return name\r\n            .toLowerCase()\r\n            .replace(/[^a-z0-9]+/g, \"-\")\r\n            .replace(/^-|-$/g, \"\");\r\n    }\r\n\r\n    render() {\r\n        if (!this._model) return html`<uui-loader></uui-loader>`;\r\n\r\n        return html`\r\n            <umb-workspace-editor alias=\"${UAI_CONNECTION_WORKSPACE_ALIAS}\">\r\n                <div id=\"header\" slot=\"header\">\r\n                    <uui-button\r\n                        href=${UAI_CONNECTION_ROOT_WORKSPACE_PATH}\r\n                        label=\"Back to connections\"\r\n                        compact\r\n                    >\r\n                        <uui-icon name=\"icon-arrow-left\"></uui-icon>\r\n                    </uui-button>\r\n                    <uui-input\r\n                        id=\"name\"\r\n                        .value=${this._model.name}\r\n                        @input=\"${this.#onNameChange}\"\r\n                        label=\"Name\"\r\n                        placeholder=\"Enter connection name\"\r\n                    >\r\n                        <uui-input-lock\r\n                            slot=\"append\"\r\n                            id=\"alias\"\r\n                            name=\"alias\"\r\n                            label=\"Alias\"\r\n                            placeholder=\"Enter alias\"\r\n                            .value=${this._model.alias}\r\n                            ?auto-width=${!!this._model.name}\r\n                            ?locked=${this._aliasLocked}\r\n                            ?readonly=${this._aliasLocked || !this._isNew}\r\n                            @input=${this.#onAliasChange}\r\n                            @lock-change=${this.#onToggleAliasLock}\r\n                        ></uui-input-lock>\r\n                    </uui-input>\r\n                </div>\r\n\r\n                ${when(\r\n                    !this._isNew && this._model,\r\n                    () => html`<umb-workspace-entity-action-menu slot=\"action-menu\"></umb-workspace-entity-action-menu>`\r\n                )}\r\n\r\n                <div slot=\"footer-info\" id=\"footer\">\r\n                    <a href=${UAI_CONNECTION_ROOT_WORKSPACE_PATH}>Connections</a>\r\n                    / ${this._model.name || \"Untitled\"}\r\n                </div>\r\n            </umb-workspace-editor>\r\n        `;\r\n    }\r\n\r\n    static styles = [\r\n        UmbTextStyles,\r\n        css`\r\n            :host {\r\n                display: block;\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n\r\n            #header {\r\n                display: flex;\r\n                flex: 1 1 auto;\r\n                gap: var(--uui-size-space-2);\r\n            }\r\n\r\n            #name {\r\n                width: 100%;\r\n                flex: 1 1 auto;\r\n                align-items: center;\r\n            }\r\n\r\n            #footer {\r\n                padding: 0 var(--uui-size-layout-1);\r\n            }\r\n        `,\r\n    ];\r\n}\r\n\r\nexport default UaiConnectionWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        \"uai-connection-workspace-editor\": UaiConnectionWorkspaceEditorElement;\r\n    }\r\n}\r\n","import type { UmbRoutableWorkspaceContext } from \"@umbraco-cms/backoffice/workspace\";\r\nimport {\r\n    UmbWorkspaceRouteManager,\r\n    UmbSubmittableWorkspaceContextBase,\r\n    UmbWorkspaceIsNewRedirectController,\r\n    UmbWorkspaceIsNewRedirectControllerAlias,\r\n} from \"@umbraco-cms/backoffice/workspace\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UmbBasicState, UmbObjectState } from \"@umbraco-cms/backoffice/observable-api\";\r\nimport { UmbEntityContext } from \"@umbraco-cms/backoffice/entity\";\r\nimport { UmbValidationContext } from \"@umbraco-cms/backoffice/validation\";\r\nimport { UaiConnectionDetailRepository } from \"../../repository/detail/connection-detail.repository.js\";\r\nimport { UAI_CONNECTION_WORKSPACE_ALIAS, UAI_CONNECTION_ENTITY_TYPE } from \"../../constants.js\";\r\nimport type { UaiConnectionDetailModel } from \"../../types.js\";\r\nimport type { UaiCommand } from \"../../../core/command/command.base.js\";\r\nimport { UaiCommandStore } from \"../../../core/command/command.store.js\";\r\nimport { UaiConnectionWorkspaceEditorElement } from \"./connection-workspace-editor.element.js\";\r\n\r\n/**\r\n * Workspace context for editing Connection entities.\r\n * Handles CRUD operations, state management, and command tracking.\r\n */\r\nexport class UaiConnectionWorkspaceContext\r\n    extends UmbSubmittableWorkspaceContextBase<UaiConnectionDetailModel>\r\n    implements UmbRoutableWorkspaceContext\r\n{\r\n    readonly routes = new UmbWorkspaceRouteManager(this);\r\n\r\n    #unique = new UmbBasicState<string | undefined>(undefined);\r\n    readonly unique = this.#unique.asObservable();\r\n\r\n    #model = new UmbObjectState<UaiConnectionDetailModel | undefined>(undefined);\r\n    readonly model = this.#model.asObservable();\r\n\r\n    #repository: UaiConnectionDetailRepository;\r\n    #commandStore = new UaiCommandStore();\r\n    #entityContext = new UmbEntityContext(this);\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host, UAI_CONNECTION_WORKSPACE_ALIAS);\r\n\r\n        this.#repository = new UaiConnectionDetailRepository(this);\r\n        this.addValidationContext(new UmbValidationContext(this));\r\n\r\n        this.#entityContext.setEntityType(UAI_CONNECTION_ENTITY_TYPE);\r\n        this.observe(this.unique, (unique) => this.#entityContext.setUnique(unique ?? null));\r\n\r\n        this.routes.setRoutes([\r\n            {\r\n                path: \"create\",\r\n                component: UaiConnectionWorkspaceEditorElement,\r\n                setup: async () => {\r\n                    await this.scaffold();\r\n\r\n                    new UmbWorkspaceIsNewRedirectController(\r\n                        this,\r\n                        this,\r\n                        this.getHostElement().shadowRoot!.querySelector(\"umb-router-slot\")!\r\n                    );\r\n                },\r\n            },\r\n            {\r\n                path: \"edit/:unique\",\r\n                component: UaiConnectionWorkspaceEditorElement,\r\n                setup: (_component, info) => {\r\n                    this.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n                    this.load(info.match.params.unique);\r\n                },\r\n            },\r\n        ]);\r\n    }\r\n\r\n    protected resetState(): void {\r\n        super.resetState();\r\n        this.#unique.setValue(undefined);\r\n        this.#model.setValue(undefined);\r\n        this.#commandStore.reset();\r\n    }\r\n\r\n    /**\r\n     * Creates a scaffold for a new connection.\r\n     */\r\n    async scaffold(providerId?: string) {\r\n        this.resetState();\r\n        const { data } = await this.#repository.createScaffold({ providerId });\r\n        if (data) {\r\n            this.#model.setValue(data);\r\n            this.setIsNew(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loads an existing connection by ID.\r\n     */\r\n    async load(id: string) {\r\n        this.resetState();\r\n        const { data, asObservable } = await this.#repository.requestByUnique(id);\r\n\r\n        if (asObservable) {\r\n            this.observe(\r\n                asObservable(),\r\n                (model) => {\r\n                    if (model) {\r\n                        this.#unique.setValue(model.unique);\r\n                        const newModel = structuredClone(model);\r\n                        // Replay any pending commands\r\n                        this.#commandStore.getAll().forEach((command) => command.execute(newModel));\r\n                        this.#model.setValue(newModel);\r\n                        this.setIsNew(false);\r\n                    }\r\n                },\r\n                \"_observeModel\"\r\n            );\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Handles a command to update the model.\r\n     * Commands are tracked for replay after model refresh.\r\n     */\r\n    handleCommand(command: UaiCommand) {\r\n        const currentValue = this.#model.getValue();\r\n        if (currentValue) {\r\n            const newValue = structuredClone(currentValue);\r\n            command.execute(newValue);\r\n            this.#model.setValue(newValue);\r\n            this.#commandStore.add(command);\r\n        }\r\n    }\r\n\r\n    getData(): UaiConnectionDetailModel | undefined {\r\n        return this.#model.getValue();\r\n    }\r\n\r\n    getUnique(): string | undefined {\r\n        return this.#unique.getValue();\r\n    }\r\n\r\n    getEntityType(): string {\r\n        return UAI_CONNECTION_ENTITY_TYPE;\r\n    }\r\n\r\n    /**\r\n     * Saves the connection (create or update).\r\n     */\r\n    async submit() {\r\n        const model = this.#model.getValue();\r\n        if (!model) return;\r\n\r\n        // Mute command store during submit\r\n        this.#commandStore.mute();\r\n\r\n        try {\r\n            if (this.getIsNew()) {\r\n                const { data, error } = await this.#repository.create(model);\r\n\r\n                if (error) {\r\n                    throw error;\r\n                }\r\n\r\n                if (data) {\r\n                    this.#unique.setValue(data.unique);\r\n                    this.#model.setValue(data);\r\n                }\r\n            } else {\r\n                const { error } = await this.#repository.save(model);\r\n\r\n                if (error) {\r\n                    throw error;\r\n                }\r\n            }\r\n\r\n            this.#commandStore.reset();\r\n            this.setIsNew(false);\r\n        } finally {\r\n            this.#commandStore.unmute();\r\n        }\r\n    }\r\n}\r\n\r\nexport { UaiConnectionWorkspaceContext as api };\r\n"],"names":["UaiCommandStore","#muted","#commands","command","x","UAI_CONNECTION_ROOT_WORKSPACE_PATH","UMB_WORKSPACE_PATH_PATTERN","UMB_SETTINGS_SECTION_PATHNAME","UAI_CONNECTION_ROOT_ENTITY_TYPE","_workspaceContext","_UaiConnectionWorkspaceEditorElement_instances","onNameChange_fn","onAliasChange_fn","onToggleAliasLock_fn","generateAlias_fn","UaiConnectionWorkspaceEditorElement","UmbLitElement","__privateAdd","UAI_CONNECTION_WORKSPACE_CONTEXT","context","__privateSet","model","isNew","html","UAI_CONNECTION_WORKSPACE_ALIAS","__privateMethod","when","event","name","alias","__privateGet","UaiPartialUpdateCommand","target","UmbTextStyles","css","__decorateClass","state","customElement","UaiConnectionWorkspaceContext","UmbSubmittableWorkspaceContextBase","host","UmbWorkspaceRouteManager","#unique","UmbBasicState","#model","UmbObjectState","#commandStore","#entityContext","UmbEntityContext","#repository","UaiConnectionDetailRepository","UmbValidationContext","UAI_CONNECTION_ENTITY_TYPE","unique","UmbWorkspaceIsNewRedirectController","_component","info","UmbWorkspaceIsNewRedirectControllerAlias","providerId","data","id","asObservable","newModel","currentValue","newValue","error"],"mappings":"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"}